## 実験計画レポート：遮蔽環境下における安全性評価実験

### 1. 実験の目的

本実験の目的は、理論的に導出された Occlusion-CBF コントローラ（二重積分モデル前提）を、非ホロノミック制約を持つ実機ロボット（Unicycleモデル）に適用した際の安全性を定量的に評価することである。

特に、シミュレーション（理想/物理）と実機の各段階において `ros2 bag` を用いてデータを取得・解析し、モデルの不整合（Mismatch）が回避挙動と安全マージンに与える影響を明らかにする。

### 2. 検証フェーズと手順

実験は以下の3段階（フェーズ）で実施し、段階的にモデルの複雑性を上げることで挙動変化の要因を特定する。

- **Phase 1: 物理シミュレータ整合性確認 (Gazebo / Double Integrator)**
    
    - **対象:** Gazebo上の全方向移動ロボット（オムニホイール等を想定した理想モデル）。
        
    - **目的:** Python数値シミュレータとGazebo物理エンジンの挙動が一致することを確認する。
        
- **Phase 2: モデルミスマッチ検証 (Gazebo / Unicycle)**
    
    - **対象:** Gazebo上のTurtleBot3モデル。
        
    - **手法:** 制御出力 $(v_x, v_y)$ を $(v, \omega)$ に変換して入力する。
        
    - **目的:** 旋回動作に伴う応答遅れが、安全性評価関数 $h(x)$ に与える悪影響を計測する。
        
- **Phase 3: 実機検証 (Real / Unicycle)**
    
    - **対象:** TurtleBot3 Burger 実機。
        
    - **目的:** センサーノイズ、通信遅延、タイヤスリップを含む実環境下での回避性能を検証する。
        

### 3. データ取得方法

実験データは ROS 2 の標準ツールである `ros2 bag` を用いて記録する。

解析の効率化のため、内部計算値（CBF値）をカスタムトピックとして出力し、以下のトピック群を全ての試行で記録する。

- **コマンド:** `ros2 bag record -o <experiment_id> /cmd_vel /odom /scan /cbf_debug_info /tf`
    
- **記録対象トピック:**
    
    - `/cmd_vel`: 制御入力指令値（並進速度 $v$, 角速度 $\omega$）。
        
    - `/odom`: ロボットの実際の軌跡・速度（オドメトリ）。
        
    - `/scan`: LiDAR点群データ（障害物検知状況）。
        
    - `/cbf_debug_info` (カスタム): コントローラ内部で計算された CBF値 $h(x)$ および計算遅延時間。
        

### 4. 評価メトリクス

取得したログデータを解析し、以下の指標を用いて定量的な評価を行う。

1. **安全性評価関数値 $h(x)$ の推移**
    
    - 理論上 $h(x) \geq 0$ であるべき値が、モデルミスマッチや遅延によりどの程度 $0$ に接近（あるいは逸脱）したかを評価する。これを「安全マージンの減少量」として定義する。
        
2. **障害物との最小距離 (Minimum Distance)**
    
    - 物理的な衝突の有無を確認する。また、設定した安全半径 $R_{safe}$ に対して、実際の最接近距離がどの程度確保されたかを計測する。
        
3. **制御追従誤差 (Tracking Error)**
    
    - 理想的な制御指令（Phase 1の結果）に対し、Unicycleモデル（Phase 2, 3）がどの程度の遅れ時間および振幅誤差を持って追従したかを評価する。
        

### 5. 想定される結果と考察の方向性

- Phase 1ではPythonシミュレータとほぼ一致する挙動が得られる。
    
- Phase 2では、急激な回避動作時に旋回遅れが生じ、$h(x)$ が一時的に低下する現象が観測されると予測される。
    
- Phase 3では、さらにノイズの影響で挙動が振動的になる可能性がある。
    
- これらを通じ、「Occlusion-CBFはモデル誤差に対してある程度のロバスト性を持つが、パラメータ設定（$v_{obs}^{max}$ 等）においては実機の遅れを考慮したマージン設計が必要である」という結論を導く。